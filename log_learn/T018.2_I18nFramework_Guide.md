# T018.2 - Set Up i18n Framework in Electron/React App - Learning Guide

**Task**: 18.2 Set up i18n framework in Electron/React app
**Date**: 2025-12-11
**Difficulty**: Intermediate

---

## Overview

This guide explains how to set up internationalization (i18n) in a React application using i18next and react-i18next. The implementation supports English and Spanish languages with automatic language detection and persistence.

---

## What We Built

An i18n framework that:

1. Detects user language automatically
2. Supports English and Spanish
3. Persists language preference in localStorage
4. Integrates with React using hooks
5. Can read language from Windows registry (installer preference)

---

## Key Libraries

### i18next

The core internationalization library that handles:
- Translation loading and caching
- Language switching
- Interpolation (variables in translations)
- Fallback languages
- Namespaces for organizing translations

### react-i18next

React bindings for i18next that provide:
- `useTranslation` hook for functional components
- `Trans` component for complex translations
- Suspense integration for async loading
- Context provider for app-wide access

### i18next-browser-languagedetector

Automatic language detection from:
- localStorage (saved preference)
- navigator (browser language)
- HTML lang attribute
- Query string parameters

---

## Step-by-Step Implementation

### Step 1: Install Dependencies

```bash
npm install i18next react-i18next i18next-browser-languagedetector
```

### Step 2: Create Locale Files

Create JSON files for each language:

```
src/i18n/locales/
├── en.json    # English translations
└── es.json    # Spanish translations
```

Example `en.json`:
```json
{
  "app": {
    "name": "My App",
    "tagline": "Welcome to My App"
  },
  "actions": {
    "submit": "Submit",
    "cancel": "Cancel"
  }
}
```

Example `es.json`:
```json
{
  "app": {
    "name": "Mi App",
    "tagline": "Bienvenido a Mi App"
  },
  "actions": {
    "submit": "Enviar",
    "cancel": "Cancelar"
  }
}
```

### Step 3: Create i18n Configuration

```typescript
// src/i18n/index.ts
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import LanguageDetector from 'i18next-browser-languagedetector';

import enTranslation from './locales/en.json';
import esTranslation from './locales/es.json';

const resources = {
  en: { translation: enTranslation },
  es: { translation: esTranslation },
};

i18n
  .use(LanguageDetector)
  .use(initReactI18next)
  .init({
    resources,
    fallbackLng: 'en',
    supportedLngs: ['en', 'es'],
    interpolation: {
      escapeValue: false, // React handles escaping
    },
    detection: {
      order: ['localStorage', 'navigator'],
      caches: ['localStorage'],
    },
  });

export default i18n;
```

### Step 4: Integrate with React

```tsx
// src/main.tsx
import React, { Suspense } from 'react';
import ReactDOM from 'react-dom/client';
import App from './App';
import './i18n'; // Import i18n before App

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <Suspense fallback={<div>Loading...</div>}>
      <App />
    </Suspense>
  </React.StrictMode>
);
```

### Step 5: Use in Components

```tsx
import { useTranslation } from 'react-i18next';

function MyComponent() {
  const { t, i18n } = useTranslation();

  return (
    <div>
      <h1>{t('app.name')}</h1>
      <p>{t('app.tagline')}</p>
      <button onClick={() => i18n.changeLanguage('es')}>
        Español
      </button>
    </div>
  );
}
```

---

## Best Practices

### 1. Organize Translations by Feature

```json
{
  "header": {
    "title": "...",
    "menu": {
      "home": "...",
      "settings": "..."
    }
  },
  "invoice": {
    "form": { ... },
    "validation": { ... }
  }
}
```

### 2. Use Consistent Key Naming

- Use dot notation: `section.subsection.key`
- Use camelCase for keys
- Keep keys descriptive but concise

### 3. Handle Missing Translations

```typescript
i18n.init({
  // Return key when translation missing (good for development)
  returnEmptyString: false,
  // Or return a custom string
  // missingKeyHandler: (lng, ns, key) => `Missing: ${key}`,
});
```

### 4. Use Interpolation for Dynamic Content

```json
{
  "welcome": "Hello, {{name}}!",
  "items": "You have {{count}} items"
}
```

```tsx
t('welcome', { name: 'John' })  // "Hello, John!"
t('items', { count: 5 })        // "You have 5 items"
```

### 5. Handle Pluralization

```json
{
  "item_one": "1 item",
  "item_other": "{{count}} items"
}
```

```tsx
t('item', { count: 1 })   // "1 item"
t('item', { count: 5 })   // "5 items"
```

---

## Language Switching

### Programmatic Change

```typescript
import { changeLanguage } from './i18n';

// Change language and persist
await changeLanguage('es');
```

### With UI Component

```tsx
function LanguageSwitcher() {
  const { i18n } = useTranslation();

  return (
    <select
      value={i18n.language}
      onChange={(e) => i18n.changeLanguage(e.target.value)}
    >
      <option value="en">English</option>
      <option value="es">Español</option>
    </select>
  );
}
```

---

## Integration with Windows Registry

For Electron apps, the language set by the installer can be read:

```typescript
// In Electron main process
import Registry from 'winreg';

const regKey = new Registry({
  hive: Registry.HKLM,
  key: '\\SOFTWARE\\MyApp'
});

regKey.get('Language', (err, item) => {
  if (!err && item) {
    mainWindow.webContents.send('language-preference', item.value);
  }
});
```

---

## Debugging

Enable debug mode in development:

```typescript
i18n.init({
  debug: process.env.NODE_ENV === 'development',
});
```

This logs:
- Missing translations
- Language detection results
- Namespace loading

---

## Common Pitfalls

### 1. Forgetting to Import i18n

The i18n configuration must be imported before the App component renders:

```tsx
// ❌ Wrong - i18n not initialized
import App from './App';
import './i18n';

// ✅ Correct - i18n imported first
import './i18n';
import App from './App';
```

### 2. Not Using Suspense

i18next with React requires Suspense for async loading:

```tsx
// ❌ Wrong - no Suspense
<App />

// ✅ Correct - with Suspense
<Suspense fallback={<Loading />}>
  <App />
</Suspense>
```

### 3. Hardcoding Text

Always use translation keys, even for "obvious" text:

```tsx
// ❌ Wrong
<button>Submit</button>

// ✅ Correct
<button>{t('actions.submit')}</button>
```

---

## Further Reading

- [i18next Documentation](https://www.i18next.com/)
- [react-i18next Documentation](https://react.i18next.com/)
- [Formatting (dates, numbers)](https://www.i18next.com/translation-function/formatting)
- [Namespaces](https://www.i18next.com/principles/namespaces)
