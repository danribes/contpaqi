# T002.2 - Mexican Locale Configuration - Learning Guide

**Subtask**: 2.2 - Configure Faker for Mexican locale
**Date**: 2025-12-03
**Audience**: Developers working with Mexican business data

---

## What Was Built

A dedicated Python module (`mexican_data.py`) for generating realistic Mexican business data, including:
- RFC (tax ID) generation and validation
- Company profiles with es_MX locale
- Person profiles with addresses

---

## Understanding Mexican RFC

### What is RFC?

RFC (Registro Federal de Contribuyentes) is Mexico's taxpayer identification number, similar to:
- SSN/EIN in USA
- NIF in Spain
- CNPJ/CPF in Brazil

### RFC Structure

```
Persona Física (Individual) - 13 characters:
┌────────────────────────────────────────┐
│  XAXX  │  850101  │  ABC  │
│  ────  │  ──────  │  ───  │
│  Name  │  Birth   │ Homo- │
│ initials│  date   │ clave │
└────────────────────────────────────────┘
   4 letters  6 digits  3 alphanum

Persona Moral (Company) - 12 characters:
┌────────────────────────────────────────┐
│  XAX  │  850101  │  ABC  │
│  ───  │  ──────  │  ───  │
│ Company│ Constit.│ Homo- │
│ initials│  date  │ clave │
└────────────────────────────────────────┘
   3 letters  6 digits  3 alphanum
```

### Letter Portion

For individuals, derived from:
1. First letter of paternal surname
2. First vowel of paternal surname
3. First letter of maternal surname
4. First letter of first name

Example: **Juan García López** → **GALJ**

### Date Portion

Format: YYMMDD
- Individuals: Birth date
- Companies: Constitution date

### Homoclave

- 3 alphanumeric characters
- Assigned by SAT (tax authority)
- Ensures uniqueness
- We generate randomly for synthetic data

---

## Faker Locales

### Why es_MX?

Faker supports multiple locales. Mexican Spanish (es_MX) provides:

```python
from faker import Faker

# Generic Spanish
fake_es = Faker('es_ES')
fake_es.name()  # → "María García Fernández"

# Mexican Spanish
fake_mx = Faker('es_MX')
fake_mx.name()  # → "María Guadalupe Hernández López"
```

### Mexican-Specific Data

| Method | Example Output |
|--------|----------------|
| `fake.name()` | "Juan Carlos Ramírez Ochoa" |
| `fake.company()` | "Grupo Industrial Mexicano" |
| `fake.address()` | "Av. Reforma 123, Col. Centro, CDMX" |
| `fake.phone_number()` | "+52 55 1234 5678" |

---

## Regex for RFC Validation

```python
import re

# Pattern for 13-character RFC (individuals)
RFC_PATTERN = re.compile(r'^[A-ZÑ&]{4}\d{6}[A-Z0-9]{3}$')

# Pattern explanation:
# ^           - Start of string
# [A-ZÑ&]{4}  - 4 uppercase letters (including Ñ and &)
# \d{6}       - 6 digits
# [A-Z0-9]{3} - 3 alphanumeric
# $           - End of string
```

### Special Characters in RFC

- **Ñ**: Valid in Mexican names
- **&**: Used when company name starts with "Y" (represents "and")

---

## Company Legal Suffixes

Mexican companies must have a legal suffix:

| Suffix | Full Name | Type |
|--------|-----------|------|
| S.A. de C.V. | Sociedad Anónima de Capital Variable | Corporation |
| S. de R.L. de C.V. | Sociedad de Responsabilidad Limitada | LLC |
| S.A.P.I. de C.V. | Sociedad Anónima Promotora de Inversión | Investment Corp |
| S.C. | Sociedad Civil | Civil Society |
| A.C. | Asociación Civil | Non-profit |

### Usage

```python
from mexican_data import add_mexican_suffix

company = "Tecnología Avanzada"
full_name = add_mexican_suffix(company)
# → "Tecnología Avanzada S.A. de C.V."
```

---

## Validation Patterns

### Good Validation Practice

```python
def validate_rfc(rfc: str) -> tuple[bool, str]:
    """Return (is_valid, error_message)"""

    if not rfc:
        return False, "RFC cannot be empty"

    if len(rfc) not in (12, 13):
        return False, f"RFC must be 12 or 13 characters, got {len(rfc)}"

    if not RFC_PATTERN.match(rfc):
        return False, "RFC format invalid"

    return True, ""
```

### Why Tuple Return?

- Avoids exceptions for expected invalid input
- Provides specific error messages
- Easy to check: `if validate_rfc(rfc)[0]: ...`

---

## Integration Example

```python
from mexican_data import get_faker, generate_company, validate_rfc

# Setup
fake = get_faker(seed=42)

# Generate invoice parties
emisor = generate_company(fake)
receptor = generate_company(fake)

# Validate
assert validate_rfc(emisor['rfc'])[0], "Invalid emisor RFC"
assert validate_rfc(receptor['rfc'])[0], "Invalid receptor RFC"

# Use in invoice
invoice = {
    'emisor': emisor,
    'receptor': receptor,
    'total': 15000.00
}
```

---

## Testing Mexican Data

### Unit Tests for RFC

```python
def test_rfc_format():
    fake = get_faker(seed=42)
    rfc = generate_rfc(fake)

    assert len(rfc) == 13
    assert rfc[:4].isalpha()
    assert rfc[4:10].isdigit()
    assert rfc[10:].isalnum()

def test_rfc_validation():
    assert validate_rfc("XAXX010101ABC")[0] is True
    assert validate_rfc("invalid")[0] is False
    assert validate_rfc("")[0] is False
```

---

## Common Pitfalls

### 1. Locale Not Set

```python
# Wrong - uses default (en_US)
fake = Faker()

# Correct - Mexican locale
fake = Faker('es_MX')
```

### 2. Forgetting Ñ in RFC

```python
# Pattern should include Ñ
RFC_PATTERN = re.compile(r'^[A-ZÑ&]{4}\d{6}[A-Z0-9]{3}$')
#                            ^^
```

### 3. Not Handling Both RFC Lengths

```python
# Wrong - only checks 13 characters
if len(rfc) != 13:
    return False

# Correct - handles both
if len(rfc) not in (12, 13):
    return False
```

---

## Next Steps

- **Subtask 2.3**: Create HTML invoice templates
- Templates will use data from mexican_data.py
- Jinja2 will render {{ emisor.rfc }}, {{ receptor.name }}, etc.
