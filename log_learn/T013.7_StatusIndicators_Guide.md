# T013.7 - Status Indicators Guide

## Overview

This guide covers the implementation of status indicators for the Electron desktop app. Status indicators provide visual feedback about the application state based on Docker container and health check statuses.

---

## Status Types

### AppStatus

The main application status derived from underlying system states:

| Status | Meaning | Visual |
|--------|---------|--------|
| `starting` | App initializing | Yellow, animated |
| `ready` | Fully operational | Green, solid |
| `error` | System error | Red, solid |
| `offline` | Service unavailable | Gray, solid |

### DockerStatus

Docker container state:

| Status | Meaning |
|--------|---------|
| `checking` | Verifying Docker status |
| `running` | Container is running |
| `stopped` | Container is stopped |
| `docker_error` | Docker daemon issue |

### HealthStatus

Service health check result:

| Status | Meaning |
|--------|---------|
| `healthy` | API responding correctly |
| `unhealthy` | API returning errors |
| `error` | Health check failed |
| `unknown` | Not yet checked |

---

## Status Derivation Logic

The `deriveAppStatus` function combines Docker and Health statuses:

```typescript
function deriveAppStatus(
  dockerStatus: DockerStatus,
  healthStatus: HealthStatus
): AppStatus {
  // Docker errors take precedence
  if (dockerStatus === 'docker_error') return 'error';
  if (dockerStatus === 'stopped') return 'offline';
  if (dockerStatus === 'checking') return 'starting';

  // Docker running - check health
  if (dockerStatus === 'running') {
    switch (healthStatus) {
      case 'healthy': return 'ready';
      case 'unhealthy': return 'error';
      case 'error': return 'error';
      case 'unknown': return 'starting';
    }
  }

  return 'starting';
}
```

### Decision Matrix

| Docker | Health | Result |
|--------|--------|--------|
| docker_error | * | error |
| stopped | * | offline |
| checking | * | starting |
| running | healthy | ready |
| running | unhealthy | error |
| running | error | error |
| running | unknown | starting |

---

## Component Variants

### 1. StatusIndicator

Simple dot indicator with optional text label.

```tsx
<StatusIndicator
  status="ready"
  showText={true}
  size="md"
/>
```

**Props:**
- `status`: AppStatus
- `message?`: Custom message
- `showText?`: Show status text (default: false)
- `size?`: 'sm' | 'md' | 'lg'

**Use Cases:**
- Sidebar status display
- General status indication

### 2. StatusBadge

Compact badge for headers with colored background.

```tsx
<StatusBadge
  status="ready"
  message="Service Ready"
/>
```

**Props:**
- `status`: AppStatus
- `message?`: Badge text

**Use Cases:**
- App header status
- Compact status display

### 3. StatusBar

Full status bar with icon, message, details, and retry action.

```tsx
<StatusBar
  dockerStatus="running"
  healthStatus="unhealthy"
  lastCheckTime={new Date()}
  onRetry={handleRetry}
  isRetrying={false}
/>
```

**Props:**
- `dockerStatus`: DockerStatus
- `healthStatus`: HealthStatus
- `lastCheckTime?`: Last check timestamp
- `onRetry?`: Retry callback
- `isRetrying?`: Loading state

**Use Cases:**
- Error states requiring user action
- Detailed status information

### 4. StartupScreen

Full-page startup screen with progress steps.

```tsx
<StartupScreen
  status="starting"
  message="Initializing services..."
  steps={[
    { label: 'Check Docker', completed: true },
    { label: 'Start Container', completed: false },
    { label: 'Verify Health', completed: false }
  ]}
/>
```

**Props:**
- `status`: AppStatus
- `message`: Current step message
- `steps?`: Progress step list

**Use Cases:**
- Application startup
- Long initialization processes

---

## Color Scheme

### Status Colors (Tailwind CSS)

| Status | Dot | Background | Text |
|--------|-----|------------|------|
| ready | green-500 | green-100 | green-800 |
| starting | yellow-500 | yellow-100 | yellow-800 |
| error | red-500 | red-100 | red-800 |
| offline | gray-500 | gray-100 | gray-800 |

### Helper Functions

```typescript
function getStatusColor(status: AppStatus): string {
  switch (status) {
    case 'ready': return 'bg-green-500';
    case 'starting': return 'bg-yellow-500';
    case 'error': return 'bg-red-500';
    case 'offline': return 'bg-gray-500';
  }
}

function getStatusTextColor(status: AppStatus): string {
  switch (status) {
    case 'ready': return 'text-green-800';
    case 'starting': return 'text-yellow-800';
    case 'error': return 'text-red-800';
    case 'offline': return 'text-gray-800';
  }
}
```

---

## Animation

The `starting` status uses a pulse animation:

```typescript
function shouldAnimate(status: AppStatus): boolean {
  return status === 'starting';
}
```

```css
/* Tailwind animate-pulse class */
.animate-pulse {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}
```

---

## Integration with App.tsx

### State Management

```typescript
const [dockerStatus, setDockerStatus] = useState<DockerStatus>('checking');
const [healthStatus, setHealthStatus] = useState<HealthStatus>('unknown');
const [startupSteps, setStartupSteps] = useState([
  { label: 'Checking Docker status', completed: false },
  { label: 'Starting container', completed: false },
  { label: 'Verifying service health', completed: false }
]);

const appStatus = deriveAppStatus(dockerStatus, healthStatus);
const isReady = appStatus === 'ready';
```

### Conditional Rendering

```tsx
function App() {
  if (appStatus === 'starting') {
    return (
      <StartupScreen
        status={appStatus}
        message={getStatusBarMessage({ dockerStatus, healthStatus })}
        steps={startupSteps}
      />
    );
  }

  return (
    <div className="app">
      <header>
        <StatusBadge status={appStatus} />
      </header>

      {appStatus === 'error' && (
        <StatusBar
          dockerStatus={dockerStatus}
          healthStatus={healthStatus}
          onRetry={handleRetry}
        />
      )}

      <main>
        <button disabled={!isReady}>Upload Invoice</button>
      </main>
    </div>
  );
}
```

---

## User Experience Flow

```
1. App Launch
   └── StartupScreen: "Checking Docker status..."

2. Docker Check Complete
   └── StartupScreen: "Starting container..."

3. Container Running
   └── StartupScreen: "Waiting for service to be ready..."

4. Health Check Passes
   └── Main UI with green StatusBadge

5. Error Occurs
   └── StatusBar with retry option
```

---

## Best Practices

1. **Single Source of Truth**: Use `deriveAppStatus()` consistently
2. **Progressive Enhancement**: Disable features until service is ready
3. **Clear Feedback**: Always show why something is disabled
4. **Retry Actions**: Provide retry options for recoverable errors
5. **Animation Sparingly**: Only animate active states

---

## Testing

Test all status combinations:

```typescript
describe('deriveAppStatus', () => {
  it('returns ready when docker running and health healthy', () => {
    expect(deriveAppStatus('running', 'healthy')).toBe('ready');
  });

  it('returns error when docker has error', () => {
    expect(deriveAppStatus('docker_error', 'healthy')).toBe('error');
  });

  // ... test all combinations
});
```

---

## References

- [Tailwind CSS Colors](https://tailwindcss.com/docs/customizing-colors)
- [React State Management](https://react.dev/learn/managing-state)
- [Accessibility: Status Messages](https://www.w3.org/WAI/WCAG21/Understanding/status-messages.html)
