# T009.6 Health Endpoint - Learning Guide

## Overview
This guide explains how to implement health check endpoints for container orchestration.

## Health Check Concepts

### Liveness vs Readiness

| Probe | Purpose | When to Fail |
|-------|---------|--------------|
| Liveness | Is the app running? | Only if crashed |
| Readiness | Is the app ready? | If dependencies unavailable |

### Kubernetes Uses

```yaml
livenessProbe:
  httpGet:
    path: /health
    port: 8000
  initialDelaySeconds: 5
  periodSeconds: 30

readinessProbe:
  httpGet:
    path: /ready
    port: 8000
  initialDelaySeconds: 10
  periodSeconds: 5
```

## Implementation Pattern

### Health Endpoint (Liveness)
```python
@app.get("/health")
async def health_check():
    """Always returns 200 if app is running."""
    return {
        "status": "healthy",
        "timestamp": datetime.utcnow().isoformat(),
        "version": "1.0.0",
        "models_loaded": engine is not None
    }
```

### Ready Endpoint (Readiness)
```python
@app.get("/ready")
async def readiness_check():
    """Returns 503 if dependencies not loaded."""
    if engine is None:
        raise HTTPException(503, "Engine not initialized")
    return {"status": "ready"}
```

## Response Fields

### Health Response
| Field | Type | Description |
|-------|------|-------------|
| status | string | Always "healthy" |
| timestamp | string | ISO 8601 format |
| version | string | API version |
| models_loaded | boolean | Engine state |

### Ready Response
| Field | Type | Description |
|-------|------|-------------|
| status | string | "ready" if OK |

## ISO 8601 Timestamp

```python
from datetime import datetime

# Generate ISO timestamp
timestamp = datetime.utcnow().isoformat()
# Result: "2025-12-07T10:30:00.000000"
```

## Status Codes

### /health
- `200 OK`: Application is alive

### /ready
- `200 OK`: Ready to serve requests
- `503 Service Unavailable`: Not ready

## Docker Healthcheck

```dockerfile
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:8000/health || exit 1
```

## Key Takeaways

1. **Separate Endpoints**: Different probes for liveness and readiness
2. **Always Return**: Health should never fail if app is running
3. **Check Dependencies**: Ready should check critical dependencies
4. **Include Metadata**: Version and timestamp help with debugging
5. **Use HTTP Status**: 200 for OK, 503 for not ready
