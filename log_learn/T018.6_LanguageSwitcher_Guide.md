# T018.6 - Language Switcher Component Guide

**Subtask**: 18.6 - Implement language switcher component
**Topic**: Building Accessible Language Selection UI Components

---

## Overview

This guide covers how to build a language switcher component for React applications using react-i18next. The component supports multiple display variants (dropdown, buttons, compact) and includes proper accessibility features.

---

## Prerequisites

- React 18+
- react-i18next configured (see Task 18.2)
- Tailwind CSS for styling
- TypeScript for type safety

---

## Core Concepts

### 1. Language Option Type

Define a structured type for language options:

```typescript
interface LanguageOption {
  code: string;      // ISO 639-1 code (en, es)
  name: string;      // English name (English, Spanish)
  nativeName: string; // Native name (English, EspaÃ±ol)
  flag: string;      // Flag emoji (ðŸ‡ºðŸ‡¸, ðŸ‡²ðŸ‡½)
}

const SUPPORTED_LANGUAGES: LanguageOption[] = [
  { code: 'en', name: 'English', nativeName: 'English', flag: 'ðŸ‡ºðŸ‡¸' },
  { code: 'es', name: 'Spanish', nativeName: 'EspaÃ±ol', flag: 'ðŸ‡²ðŸ‡½' },
];
```

### 2. Component Props Pattern

Design flexible props that allow customization:

```typescript
interface LanguageSwitcherProps {
  currentLanguage?: string;   // Override i18n.language
  onLanguageChange?: (lng: string) => void;  // Callback
  showFlags?: boolean;        // Toggle flag display
  showNativeName?: boolean;   // Show native vs English name
  variant?: 'dropdown' | 'buttons' | 'compact';
  className?: string;         // Custom styling
}
```

---

## Display Variants

### Dropdown Variant

Best for settings pages with limited space:

```tsx
function DropdownVariant({ currentLang, onSelect }) {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        aria-expanded={isOpen}
        aria-haspopup="true"
      >
        {currentLang.flag} {currentLang.nativeName}
        <ChevronIcon />
      </button>

      {isOpen && (
        <div className="absolute mt-2 w-48 bg-white shadow-lg rounded-md">
          {SUPPORTED_LANGUAGES.map(lang => (
            <button
              key={lang.code}
              onClick={() => {
                onSelect(lang.code);
                setIsOpen(false);
              }}
            >
              {lang.flag} {lang.nativeName}
            </button>
          ))}
        </div>
      )}
    </div>
  );
}
```

### Button Group Variant

Best for visible language selection:

```tsx
function ButtonsVariant({ currentLang, onSelect }) {
  return (
    <div className="inline-flex gap-1 p-1 bg-gray-50 rounded-lg">
      {SUPPORTED_LANGUAGES.map(lang => (
        <button
          key={lang.code}
          className={lang.code === currentLang.code
            ? 'bg-primary-600 text-white'
            : 'bg-gray-100 text-gray-700'}
          onClick={() => onSelect(lang.code)}
          aria-pressed={lang.code === currentLang.code}
        >
          {lang.flag} {lang.nativeName}
        </button>
      ))}
    </div>
  );
}
```

### Compact Variant

Best for headers with minimal space:

```tsx
function CompactVariant({ currentLang, onSelect }) {
  const toggleLanguage = () => {
    const codes = SUPPORTED_LANGUAGES.map(l => l.code);
    const currentIdx = codes.indexOf(currentLang.code);
    const nextIdx = (currentIdx + 1) % codes.length;
    onSelect(codes[nextIdx]);
  };

  return (
    <button
      className="px-2 py-1 text-xs font-bold uppercase"
      onClick={toggleLanguage}
    >
      {currentLang.code.toUpperCase()}
    </button>
  );
}
```

---

## i18n Integration

### Using useTranslation Hook

```tsx
import { useTranslation } from 'react-i18next';

function LanguageSwitcher({ onLanguageChange }) {
  const { i18n } = useTranslation();

  const handleSelect = async (code: string) => {
    // Change language via i18next
    await i18n.changeLanguage(code);

    // Persist to localStorage
    localStorage.setItem('i18nextLng', code);

    // Notify parent component
    onLanguageChange?.(code);
  };

  return <DropdownVariant currentLang={...} onSelect={handleSelect} />;
}
```

### Language Persistence

i18next can be configured to persist language preference:

```typescript
// i18n/index.ts
i18n.init({
  detection: {
    order: ['localStorage', 'navigator'],
    caches: ['localStorage'],
    lookupLocalStorage: 'i18nextLng',
  },
});
```

---

## Accessibility Best Practices

### ARIA Attributes

```tsx
// Dropdown button
<button
  role="combobox"
  aria-label={`Language selector. Current: ${currentLang.name}`}
  aria-expanded={isOpen}
  aria-haspopup="true"
>

// Language option
<div
  role="option"
  aria-current={isSelected ? 'true' : undefined}
>
```

### Keyboard Navigation

Handle common keyboard interactions:

```typescript
function handleKeyDown(key: string, isOpen: boolean) {
  switch (key) {
    case 'Enter':
    case ' ':
      return isOpen ? 'select' : 'toggle';
    case 'Escape':
      return isOpen ? 'close' : 'none';
    case 'ArrowDown':
    case 'ArrowUp':
      return isOpen ? 'navigate' : 'toggle';
    default:
      return 'none';
  }
}
```

### Focus Management

Close dropdown when clicking outside:

```tsx
useEffect(() => {
  function handleClickOutside(event: MouseEvent) {
    if (containerRef.current &&
        !containerRef.current.contains(event.target as Node)) {
      setIsOpen(false);
    }
  }

  document.addEventListener('mousedown', handleClickOutside);
  return () => document.removeEventListener('mousedown', handleClickOutside);
}, []);
```

---

## Tailwind Styling Pattern

### Conditional Classes Function

```typescript
function getButtonClasses(isOpen: boolean): string {
  const base = 'inline-flex items-center gap-2 px-3 py-2 text-sm font-medium';
  const normal = 'text-gray-700 bg-white border border-gray-300';
  const hover = 'hover:bg-gray-50';
  const focus = 'focus:outline-none focus:ring-2 focus:ring-primary-500';
  const active = isOpen ? 'ring-2 ring-primary-500' : '';

  return `${base} ${normal} ${hover} ${focus} ${active}`.trim();
}
```

### Menu Animation

```css
/* With Tailwind + transition */
<div className={`
  absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg
  transition-all duration-200 origin-top-right
  ${isOpen
    ? 'opacity-100 scale-100'
    : 'opacity-0 scale-95 pointer-events-none'}
`}>
```

---

## Testing Strategies

### Test Helper Functions Separately

```typescript
describe('getLanguageByCode', () => {
  it('should return language for valid code', () => {
    expect(getLanguageByCode('en')?.name).toBe('English');
  });

  it('should return undefined for invalid code', () => {
    expect(getLanguageByCode('invalid')).toBeUndefined();
  });
});
```

### Test State Transitions

```typescript
describe('Dropdown State', () => {
  it('should toggle dropdown on click', () => {
    let isOpen = false;
    const toggle = () => { isOpen = !isOpen; };

    toggle();
    expect(isOpen).toBe(true);

    toggle();
    expect(isOpen).toBe(false);
  });
});
```

### Test Callbacks

```typescript
describe('Language Change', () => {
  it('should call callback with new language', () => {
    let changed: string | null = null;
    const callback = (lng: string) => { changed = lng; };

    callback('es');
    expect(changed).toBe('es');
  });
});
```

---

## Common Patterns

### Getting Current Language

```typescript
function getCurrentLang(): LanguageOption {
  const code = i18n.language || 'en';
  return SUPPORTED_LANGUAGES.find(l => l.code === code)
    || SUPPORTED_LANGUAGES[0];
}
```

### Validating Language Code

```typescript
function isValidLanguageCode(code: string): boolean {
  if (!code || code.trim() === '') return false;
  return SUPPORTED_LANGUAGES.some(l => l.code === code);
}
```

### Formatting Display Text

```typescript
function formatDisplay(lang: LanguageOption, showFlag: boolean, showNative: boolean): string {
  const parts: string[] = [];
  if (showFlag) parts.push(lang.flag);
  parts.push(showNative ? lang.nativeName : lang.name);
  return parts.join(' ');
}
```

---

## Usage Examples

### In App Header

```tsx
import { LanguageSwitcher } from './components/LanguageSwitcher';

function Header() {
  return (
    <header className="flex items-center justify-between p-4">
      <Logo />
      <nav>...</nav>
      <LanguageSwitcher variant="compact" />
    </header>
  );
}
```

### In Settings Page

```tsx
import { LanguageSwitcher } from './components/LanguageSwitcher';
import { useTranslation } from 'react-i18next';

function SettingsPage() {
  const { t } = useTranslation();

  return (
    <div className="p-6">
      <h1>{t('settings.title')}</h1>

      <div className="mt-6">
        <label className="block text-sm font-medium text-gray-700">
          {t('settings.language')}
        </label>
        <div className="mt-2">
          <LanguageSwitcher
            variant="dropdown"
            onLanguageChange={(lng) => {
              // Optional: Track analytics
              analytics.track('language_changed', { language: lng });
            }}
          />
        </div>
      </div>
    </div>
  );
}
```

---

## Files Reference

| File | Purpose |
|------|---------|
| `src/components/LanguageSwitcher.tsx` | Main component |
| `src/i18n/index.ts` | i18n configuration |
| `tests/language-switcher.test.ts` | Component tests |

---

## Related Tasks

- **Task 18.2**: i18n framework setup
- **Task 18.3**: English language file
- **Task 18.4**: Spanish language file
- **Task 18.5**: i18n component integration
