# T006.1 TATR Module Structure - Learning Guide

## Overview
This guide explains the Table Transformer (TATR) module for detecting tables in invoice images.

## What is TATR?

**Table Transformer** is a neural network model from Microsoft that detects:
- Tables (the overall structure)
- Table rows
- Table columns
- Column headers

It's based on DETR (Detection Transformer) architecture.

## Object Detection for Tables

Traditional approach: Rules and heuristics
TATR approach: Treat tables as objects to detect

```
Image → Neural Network → Bounding Boxes + Labels
```

## TableDetection Dataclass

```python
@dataclass
class TableDetection:
    label: str       # What was detected
    confidence: float # How certain (0-1)
    bbox: tuple      # Where (x1, y1, x2, y2)
```

### Labels
- `table` - The main table boundary
- `table row` - Individual row
- `table column` - Column division
- `table column header` - Header cell

## TATRModel Class

```python
class TATRModel:
    DEFAULT_MODEL_NAME = "microsoft/table-transformer-detection"
    DEFAULT_THRESHOLD = 0.7

    def detect(image) -> List[TableDetection]
    def get_table_rows(image) -> List[Dict]
    def get_table_bounds(image) -> Dict
```

## Why 0.7 Threshold?

- **Too low (0.3)**: Many false positives
- **Too high (0.95)**: Miss valid detections
- **0.7**: Good balance for invoices

Adjustable per-call:
```python
model.detect(image, threshold=0.5)  # More detections
model.detect(image, threshold=0.9)  # Fewer, higher confidence
```

## HuggingFace Integration

Uses Transformers library:
```python
from transformers import (
    AutoImageProcessor,        # Image preprocessing
    AutoModelForObjectDetection # The model
)
```

## Dataclass Validation

```python
@dataclass
class TableDetection:
    label: str
    confidence: float
    bbox: tuple

    def __post_init__(self):
        if len(self.bbox) != 4:
            raise ValueError("bbox must have 4 elements")
        if not 0 <= self.confidence <= 1:
            raise ValueError("confidence must be 0-1")
```

`__post_init__` runs after dataclass initialization - perfect for validation.
