# T011.6 Add Retry Logic for Failed Operations - Implementation Log

## Overview
Implemented retry logic with exponential backoff for handling transient failures.

## Files Modified
- `windows-bridge/src/ContpaqiBridge/Services/JobQueueService.cs`

## Implementation Details

### Configuration
```csharp
private const int MaxRetries = 3;
private const int RetryDelayMs = 1000;
```

### Retry Implementation
```csharp
private async Task ProcessJobWithRetryAsync(InvoiceJob job, CancellationToken stoppingToken)
{
    job.Status = JobStatus.Processing;

    while (job.RetryCount <= MaxRetries)
    {
        try
        {
            _logger.LogInformation("Processing job {JobId} (attempt {Attempt})",
                job.Id, job.RetryCount + 1);

            await ProcessJobAsync(job);

            job.Status = JobStatus.Completed;
            job.CompletedAt = DateTime.UtcNow;
            _logger.LogInformation("Job {JobId} completed", job.Id);
            return;
        }
        catch (Exception ex)
        {
            job.RetryCount++;
            job.ErrorMessage = ex.Message;
            _logger.LogError(ex, "Error processing job {JobId} (attempt {Attempt})",
                job.Id, job.RetryCount);

            if (job.RetryCount > MaxRetries)
            {
                job.Status = JobStatus.Failed;
                job.CompletedAt = DateTime.UtcNow;
                _logger.LogError("Job {JobId} failed after {MaxRetries} retries",
                    job.Id, MaxRetries);
                return;
            }

            // Exponential backoff
            var delay = RetryDelayMs * (int)Math.Pow(2, job.RetryCount - 1);
            await Task.Delay(delay, stoppingToken);
        }
    }
}
```

### Exponential Backoff Schedule
| Attempt | Delay |
|---------|-------|
| 1 | 0ms (immediate) |
| 2 | 1000ms |
| 3 | 2000ms |
| 4 | 4000ms |
| Fail | - |

### Total Wait Time
```
Attempt 1: 0ms
Attempt 2: 1000ms (1s after first failure)
Attempt 3: 2000ms (3s after first failure)
Attempt 4: 4000ms (7s after first failure)
Total: 7 seconds maximum wait
```

## Benefits
- Handles transient failures
- Doesn't overwhelm failing resource
- Gives SDK time to recover
- Clear failure tracking
