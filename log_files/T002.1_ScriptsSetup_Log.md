# T002.1 - Scripts Setup - Implementation Log

**Subtask**: 2.1 - Set up Python environment with Faker and WeasyPrint in scripts/
**Date**: 2025-12-03
**Duration**: ~15 minutes
**Status**: Completed

---

## Summary

Set up the Python environment for generating synthetic invoices, including:
- Created requirements.txt with all necessary dependencies
- Created generate_invoices.py script with CLI interface
- Created templates/ directory for invoice templates

---

## Implementation Details

### Files Created

#### scripts/requirements.txt

Dependencies for invoice generation:
- `faker==22.0.0` - Generate fake Mexican business data
- `weasyprint==60.1` - Render HTML to PDF
- `Pillow==10.1.0` - Image processing
- `jinja2==3.1.2` - HTML template rendering
- `pdf2image==1.16.3` - Convert PDF to images for bbox calculation
- `pytesseract==0.3.10` - OCR for ground truth extraction
- `tqdm==4.66.1` - Progress bar for generation

#### scripts/generate_invoices.py

Main script with the following structure:

**Functions:**
- `generate_rfc(fake)` - Generate valid Mexican RFC numbers
- `generate_invoice_data(fake)` - Generate random invoice data
- `render_invoice_pdf(template, data, output)` - Render PDF from template
- `save_ground_truth(data, bboxes, output)` - Save JSON labels
- `get_available_templates(dir)` - List available templates
- `generate_dataset(samples, output, templates)` - Main generation loop
- `main()` - CLI entry point

**CLI Arguments:**
- `--num-samples, -n` - Number of invoices to generate (default: 100)
- `--output-dir, -o` - Output directory (default: ../data/synthetic)
- `--templates-dir, -t` - Templates directory (default: templates)
- `--seed, -s` - Random seed for reproducibility (default: 42)

#### scripts/templates/

Empty directory ready for HTML invoice templates (Subtask 2.3).

---

## Key Design Decisions

1. **Mexican Locale (es_MX)**: Faker configured for Mexican Spanish to generate realistic company names, addresses, and data.

2. **RFC Generator**: Custom function that follows the official Mexican RFC format:
   - 4 letters (initials)
   - 6 digits (date YYMMDD)
   - 3 alphanumeric (homoclave)

3. **16% IVA**: Mexican tax rate hardcoded for invoice calculations.

4. **Reproducible Generation**: Seeds for both Faker and random module ensure consistent output.

5. **Graceful Degradation**: Script works even without templates, generating JSON labels only.

---

## Dependencies Flow

```
generate_invoices.py
├── faker (es_MX locale)
│   ├── company names
│   ├── addresses
│   └── dates
├── jinja2
│   └── HTML template rendering
├── weasyprint
│   └── PDF generation
└── tqdm
    └── progress bar
```

---

## Next Steps

- **Subtask 2.2**: Configure Faker for Mexican locale with RFC validation
- **Subtask 2.3**: Create 10 HTML invoice templates
