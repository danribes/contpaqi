# T002.2 - Mexican Locale Configuration - Implementation Log

**Subtask**: 2.2 - Configure Faker for Mexican locale (Names, RFCs, Addresses)
**Date**: 2025-12-03
**Duration**: ~15 minutes
**Status**: Completed

---

## Summary

Created a dedicated Mexican data generation module with:
- Faker configured for es_MX locale
- RFC generation following official Mexican format
- RFC validation with detailed error messages
- Company and person profile generation

---

## Implementation Details

### File Created: scripts/mexican_data.py

**Functions Implemented:**

| Function | Purpose |
|----------|---------|
| `get_faker(seed)` | Get Faker instance with es_MX locale |
| `generate_rfc(fake, persona_moral)` | Generate valid Mexican RFC |
| `validate_rfc(rfc)` | Validate RFC format with error messages |
| `generate_company(fake)` | Generate complete company profile |
| `generate_person(fake)` | Generate complete person profile |
| `format_currency(amount)` | Format as Mexican currency |
| `generate_folio()` | Generate invoice folio number |
| `add_mexican_suffix(name)` | Add legal suffix (S.A. de C.V., etc.) |

---

## RFC Format Details

### Mexican RFC Structure

```
Persona Física (Individual): 13 characters
XAXX850101ABC
├──┘├─────┘├─┘
│   │      └── Homoclave (3 alphanumeric)
│   └────────── Date YYMMDD (birth date)
└────────────── Letters (4 from name initials)

Persona Moral (Company): 12 characters
XAX850101ABC
├─┘├─────┘├─┘
│  │      └── Homoclave (3 alphanumeric)
│  └───────── Date YYMMDD (constitution date)
└──────────── Letters (3 from company name)
```

### Validation Rules

1. Length must be 12 (company) or 13 (individual)
2. First 3-4 characters must be letters
3. Next 6 characters must be digits (YYMMDD)
4. Last 3 characters must be alphanumeric
5. Date must be valid (month 1-12, day 1-31)

---

## Code Highlights

### RFC Generator

```python
def generate_rfc(fake, persona_moral=False):
    num_letters = 3 if persona_moral else 4
    letters = ''.join(random.choices('ABCDEFGHIJKLMNOPQRSTUVWXYZ', k=num_letters))
    date = fake.date_of_birth(minimum_age=18, maximum_age=80)
    date_str = date.strftime('%y%m%d')
    homoclave = ''.join(random.choices('ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789', k=3))
    return f"{letters}{date_str}{homoclave}"
```

### RFC Validation

```python
RFC_PATTERN = re.compile(r'^[A-ZÑ&]{4}\d{6}[A-Z0-9]{3}$')

def validate_rfc(rfc):
    if len(rfc) not in (12, 13):
        return False, f"RFC must be 12 or 13 characters"
    if not RFC_PATTERN.match(rfc):
        return False, "RFC format invalid"
    return True, ""
```

---

## Mexican Company Suffixes

The module includes common Mexican legal suffixes:
- `S.A. de C.V.` - Sociedad Anónima de Capital Variable
- `S. de R.L. de C.V.` - Sociedad de Responsabilidad Limitada
- `S.A.P.I. de C.V.` - Sociedad Anónima Promotora de Inversión
- `S.C.` - Sociedad Civil
- `A.C.` - Asociación Civil

---

## Integration with generate_invoices.py

The mexican_data.py module is designed to be imported by generate_invoices.py:

```python
from mexican_data import get_faker, generate_company, validate_rfc

fake = get_faker(seed=42)
emisor = generate_company(fake)
receptor = generate_company(fake)
```

---

## Next Steps

- **Subtask 2.3**: Create 10 HTML invoice templates using Jinja2
- **Subtask 2.5**: Integrate mexican_data.py into generate_invoices.py
